# 双因子登录注册系统 - 使用说明

## 项目概述

这是一个基于 Spring Boot + Vue 3 的用户登录注册系统，支持手机号/Slave字段登录，并包含网格编码和双因子码的信息填写功能。

## 技术栈

### 后端
- Spring Boot 4.0.0
- MyBatis 3.0.3
- MySQL 8.x
- JWT (JSON Web Token)
- Lombok

### 前端
- Vue 3
- Vue Router 4
- Axios

## 部署步骤

### 1. 数据库配置

在 MySQL 中执行 `database.sql` 文件创建数据库和表：

```bash
mysql -h 192.168.1.142 -P 3306 -u root -pRoot@123456 < database.sql
```

或者手动登录 MySQL 执行：

```sql
source database.sql;
```

### 2. 后端启动

#### 2.1 安装依赖
```bash
cd SYZ
mvnw clean install
```

#### 2.2 启动后端服务
```bash
mvnw spring-boot:run
```

后端服务将在 `http://localhost:8080` 启动。

### 3. 前端启动

#### 3.1 安装依赖
```bash
cd syz_vue
npm install
```

#### 3.2 启动开发服务器
```bash
npm run serve
```

前端服务将在 `http://localhost:8080` 或其他可用端口启动（如果8080被占用）。

## 功能说明

### 1. 用户注册流程

1. 访问注册页面 `/register`
2. 填写以下信息：
   - 姓名
   - 手机号（11位）
   - 密码（至少6位）
   - 确认密码
3. 点击"注册"按钮
4. 注册成功后：
   - 系统自动生成唯一的 Slave 字段
   - `is_fillin` 字段设置为 0（未填写）
   - 自动登录并跳转到信息填写页面

### 2. 用户登录流程

1. 访问登录页面 `/login`
2. 填写账号和密码：
   - 账号：可以是手机号或 Slave 字段
   - 密码
3. 点击"登录"按钮
4. 登录成功后：
   - 如果 `is_fillin = 0`，跳转到信息填写页面
   - 如果 `is_fillin = 1`，跳转到成功页面

### 3. 信息填写流程

1. 登录/注册成功后自动跳转到信息填写页面 `/fillInfo`
2. 填写以下信息：
   - 网格编码
   - 双因子码
3. 点击"提交"按钮
4. 提交成功后：
   - `is_fillin` 字段更新为 1（已填写）
   - 跳转到成功页面

### 4. 成功页面

- 显示欢迎信息
- 提供退出登录功能

## API 接口说明

### 用户注册
- **接口**: `POST /api/user/register`
- **请求参数**:
```json
{
  "name": "张三",
  "phone": "13800138000",
  "password": "123456",
  "confirmPassword": "123456"
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "token": "jwt_token_string",
    "userId": 1,
    "name": "张三",
    "isFillin": 0
  }
}
```

### 用户登录
- **接口**: `POST /api/user/login`
- **请求参数**:
```json
{
  "account": "13800138000",  // 手机号或slave字段
  "password": "123456"
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "jwt_token_string",
    "userId": 1,
    "name": "张三",
    "isFillin": 0
  }
}
```

### 填写信息
- **接口**: `POST /api/user/fillInfo`
- **请求参数**:
```json
{
  "userId": 1,
  "gridCode": "GRID001",
  "twoFactorCode": "2FA123456"
}
```
- **响应**:
```json
{
  "code": 200,
  "message": "信息填写成功",
  "data": null
}
```

## 数据库表结构

### user 表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | BIGINT | 用户ID（主键，自增） |
| name | VARCHAR(50) | 姓名 |
| phone | VARCHAR(11) | 手机号（唯一） |
| slave | VARCHAR(50) | Slave字段（唯一，用于登录） |
| password | VARCHAR(255) | 密码 |
| is_fillin | TINYINT | 是否已填写信息（0-未填写，1-已填写） |
| grid_code | VARCHAR(100) | 网格编码 |
| two_factor_code | VARCHAR(100) | 双因子码 |
| create_time | TIMESTAMP | 创建时间 |
| update_time | TIMESTAMP | 更新时间 |

## 注意事项

1. **数据库连接**：确保 MySQL 服务器在 `192.168.1.142:3306` 可访问
2. **端口冲突**：如果 8080 端口被占用，需要修改后端配置文件中的端口
3. **跨域问题**：后端已配置 CORS，允许所有来源访问
4. **密码安全**：当前版本密码为明文存储，生产环境建议使用 BCrypt 等加密方式
5. **Token 有效期**：JWT Token 默认有效期为 24 小时（86400000ms）

## 项目目录结构

### 后端 (SYZ)
```
SYZ/
├── src/main/java/com/cuco/syz/
│   ├── controller/          # 控制器层
│   │   └── UserController.java
│   ├── service/             # 服务层
│   │   └── UserService.java
│   ├── mapper/              # 数据访问层
│   │   └── UserMapper.java
│   ├── entity/              # 实体类
│   │   └── User.java
│   ├── dto/                 # 数据传输对象
│   │   ├── LoginRequest.java
│   │   ├── RegisterRequest.java
│   │   ├── FillInfoRequest.java
│   │   └── Result.java
│   ├── util/                # 工具类
│   │   └── JwtUtil.java
│   └── SyzApplication.java  # 启动类
└── src/main/resources/
    ├── mapper/              # MyBatis XML
    │   └── UserMapper.xml
    └── application.properties
```

### 前端 (syz_vue)
```
syz_vue/
├── src/
│   ├── views/               # 页面组件
│   │   ├── Login.vue        # 登录页
│   │   ├── Register.vue     # 注册页
│   │   ├── FillInfo.vue     # 信息填写页
│   │   └── Success.vue      # 成功页
│   ├── api/                 # API接口
│   │   └── user.js
│   ├── utils/               # 工具类
│   │   └── request.js
│   ├── router/              # 路由配置
│   │   └── index.js
│   ├── App.vue
│   └── main.js
└── package.json
```

## 常见问题

### 1. 后端无法连接数据库
- 检查 MySQL 服务是否启动
- 检查数据库连接配置是否正确
- 检查网络是否可达

### 2. 前端请求失败
- 检查后端服务是否启动
- 检查 API 地址配置是否正确
- 检查浏览器控制台错误信息

### 3. 登录后无法跳转
- 检查浏览器 localStorage 是否可用
- 检查路由配置是否正确

## 开发者信息

- 项目名称：双因子登录注册系统
- 版本：1.0.0
- 开发日期：2024年12月

## 许可证

本项目仅供学习和研究使用。
